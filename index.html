.gte('appointment_date', startOfWeek.toISOString().split('T')[0])
                    .lte('appointment_date', endOfWeek.toISOString().split('T')[0]);
                
                if (weekError) throw weekError;
                document.getElementById('week-appointments-count').textContent = weekAppointments.length;
                
            } catch (error) {
                console.error('Error loading doctor data:', error);
                showNotification('Error al cargar datos del m√©dico', 'warning');
            }
        }

        // ========================================= 
        //         FUNCIONES QUE FALTABAN            
        // ========================================= 

        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function formatDateShort(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('es-ES');
        }

        function getGenderLabel(gender) {
            const labels = {
                'M': 'Masculino',
                'F': 'Femenino', 
                'Other': 'Otro'
            };
            return labels[gender] || 'No especificado';
        }

        function calculateAge(birthDate) {
            if (!birthDate) return null;
            
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            
            return age;
        }

        supabase.auth.onAuthStateChange((event, session) => {
            if (event === 'SIGNED_IN' && session) {
                loadUserFromSession(session.user);
            } else if (event === 'SIGNED_OUT') {
                currentUser = null;
                userType = null;
                showLandingPage();
            }
        });

        async function loadUserFromSession(authUser) {
            try {
                const { data: patient } = await supabase
                    .from('patients')
                    .select('*')
                    .eq('email', authUser.email)
                    .eq('status', 'active')
                    .single();

                if (patient) {
                    currentUser = patient;
                    userType = 'patient';
                    showPatientDashboard();
                    return;
                }

                const { data: doctor } = await supabase
                    .from('doctors')
                    .select('*')
                    .eq('email', authUser.email)
                    .eq('status', 'active')
                    .single();

                if (doctor) {
                    currentUser = doctor;
                    userType = 'doctor';
                    showDoctorDashboard();
                }
            } catch (error) {
                console.error('Error loading user profile:', error);
            }
        }

        console.log('TuCliniCard System initialized successfully');
    </script>
</body>
</html>
