<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TuCliniCard - Sistema Médico Familiar Completo</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* Estilos generales */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-blue: #1e40af;
            --secondary-teal: #0891b2;
            --accent-green: #059669;
            --text-gray: #374151;
            --light-bg: #f8fafc;
            --white: #ffffff;
            --error: #dc2626;
            --success: #16a34a;
            --warning: #f59e0b;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-gray);
            background: var(--light-bg);
        }

        /* ========================================= */
        /*              LOADING SPINNER              */
        /* ========================================= */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ========================================= */
        /*                 HEADER                   */
        /* ========================================= */
        <div class="header">
            <nav class="nav-container">
                <div class="logo" onclick="showLandingPage()">
                    <i class="fas fa-user-md"></i>
                    TuCliniCard
                </div>
                <!-- Navegación -->
                <ul class="nav-menu">
                    <li><a onclick="showLandingPage()">Inicio</a></li>
                    <li><a onclick="scrollToSection('doctors')">Doctores</a></li>
                    <li><a onclick="scrollToSection('services')">Servicios</a></li>
                    <li><a onclick="scrollToSection('contact')">Contacto</a></li>
                </ul>
                <!-- Botones de inicio de sesión -->
                <div class="nav-buttons" id="nav-buttons">
                    <button class="btn btn-outline" onclick="openModal('patient-login')">
                        <i class="fas fa-user"></i> Pacientes
                    </button>
                    <button class="btn btn-primary" onclick="openModal('doctor-login')">
                        <i class="fas fa-user-md"></i> Médicos
                    </button>
                </div>
            </nav>
        </div>

        <!-- ========================================= -->
        <!--         LANDING PAGE (Inicio)            -->
        <!-- ========================================= -->
        <section class="hero">
            <div class="hero-content">
                <h1>Atención Médica de Confianza</h1>
                <p>Consultas presenciales y telemedicina con médicos especialistas certificados.</p>
                <div class="hero-buttons">
                    <button class="btn btn-hero btn-white" onclick="openModal('appointment')">
                        <i class="fas fa-calendar-plus"></i> Agendar Cita
                    </button>
                    <button class="btn btn-hero btn-outline" onclick="openModal('patient-register')">
                        <i class="fas fa-user-plus"></i> Registrarse
                    </button>
                </div>
            </div>
        </section>

        <!-- ========================================= -->
        <!--         DOCTORS SECTION (Lista Médicos)   -->
        <!-- ========================================= -->
        <section class="section doctors" id="doctors">
            <div class="container">
                <div class="section-title">
                    <h2>Nuestro Equipo Médico</h2>
                    <p>Especialistas certificados con amplia experiencia, dedicados al cuidado integral de tu salud</p>
                </div>
                <div class="doctors-grid">
                    <!-- Aquí se generan dinámicamente las tarjetas de los médicos -->
                    <!-- Cada card representa a un médico con su foto, nombre y especialidad -->
                    <!-- Este contenido se llenará usando la función loadDoctorData() -->
                </div>
            </div>
        </section>

        <!-- ========================================= -->
        <!--              MODALS (Formularios)         -->
        <!-- ========================================= -->
        <!-- Modal para login de paciente -->
        <div id="patient-login" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('patient-login')">&times;</span>
                <h2><i class="fas fa-user"></i> Portal del Paciente</h2>
                <form id="patient-login-form" onsubmit="loginPatient(event)">
                    <!-- Campos del formulario para login de paciente -->
                    <div class="form-group">
                        <label for="patient-email">Email:</label>
                        <input type="email" id="patient-email" name="email" required placeholder="juan.perez@test.com">
                    </div>
                    <div class="form-group">
                        <label for="patient-password">Contraseña:</label>
                        <input type="password" id="patient-password" name="password" required placeholder="test123">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                    </button>
                    <p style="text-align: center; margin-top: 1rem;">
                        <a href="#" onclick="switchModal('patient-login', 'patient-register')" style="color: var(--primary-blue);">
                            ¿No tienes cuenta? Regístrate aquí
                        </a>
                    </p>
                </form>
            </div>
        </div>

        <!-- Modal para registrar nuevo paciente -->
        <div id="patient-register" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('patient-register')">&times;</span>
                <h2><i class="fas fa-user-plus"></i> Registro de Paciente</h2>
                <form id="patient-register-form" onsubmit="registerPatient(event)">
                    <!-- Campos del formulario para registrar nuevo paciente -->
                </form>
            </div>
        </div>

        <!-- ========================================= -->
        <!--          JAVASCRIPT FUNCIONES            -->
        <!-- ========================================= -->
        <script>
            // Configuración de Supabase
            const SUPABASE_URL = 'https://ooacvnvxuvnhwodpqwoh.supabase.co';
            const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY';
            const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

            let currentUser = null;  // Usuario actual (paciente o médico)
            let userType = null;  // Tipo de usuario (paciente o médico)

            // Función para mostrar el spinner de carga
            function showLoading() {
                document.getElementById('loading').style.display = 'flex';
            }

            // Función para ocultar el spinner de carga
            function hideLoading() {
                document.getElementById('loading').style.display = 'none';
            }

            // Función para mostrar la página de inicio
            function showLandingPage() {
                document.getElementById('landing-page').style.display = 'block';
                document.getElementById('patient-dashboard').classList.remove('active');
                document.getElementById('doctor-dashboard').classList.remove('active');
                updateNavButtons();
            }

            // Función para actualizar los botones de navegación
            function updateNavButtons() {
                const navButtons = document.getElementById('nav-buttons');
                if (currentUser) {
                    navButtons.innerHTML = `
                        <span style="color: var(--primary-blue); font-weight: 600;">
                            <i class="fas fa-user"></i> ${currentUser.name}
                        </span>
                        <button class="btn btn-outline" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> Salir
                        </button>
                    `;
                } else {
                    navButtons.innerHTML = `
                        <button class="btn btn-outline" onclick="openModal('patient-login')">
                            <i class="fas fa-user"></i> Pacientes
                        </button>
                        <button class="btn btn-primary" onclick="openModal('doctor-login')">
                            <i class="fas fa-user-md"></i> Médicos
                        </button>
                    `;
                }
            }

            // Función para iniciar sesión de paciente
            async function loginPatient(event) {
                event.preventDefault();
                showLoading();

                const formData = new FormData(event.target);
                const email = formData.get('email');
                const password = formData.get('password');

                try {
                    const { data: authData, error: authError } = await supabase.auth.signInWithPassword({
                        email: email,
                        password: password
                    });

                    if (authError) throw authError;

                    const { data: patient, error: patientError } = await supabase
                        .from('patients')
                        .select('*')
                        .eq('email', email)
                        .eq('status', 'active')
                        .single();

                    if (patientError || !patient) {
                        throw new Error('Paciente no encontrado o inactivo');
                    }

                    currentUser = patient;
                    userType = 'patient';
                    closeModal('patient-login');
                    showLandingPage();
                    updateNavButtons();
                } catch (error) {
                    console.error('Error en login:', error);
                    alert(error.message);
                } finally {
                    hideLoading();
                }
            }

            // Función para cerrar sesión
            async function logout() {
                try {
                    const { error } = await supabase.auth.signOut();
                    if (error) throw error;

                    currentUser = null;
                    userType = null;
                    showLandingPage();
                    updateNavButtons();
                } catch (error) {
                    console.error('Error al cerrar sesión:', error);
                }
            }

            // Función para abrir el modal
            function openModal(modalId) {
                document.getElementById(modalId).style.display = 'block';
            }

            // Función para cerrar el modal
            function closeModal(modalId) {
                document.getElementById(modalId).style.display = 'none';
            }

            // Función para mostrar los médicos (esto puede ser dinámico)
            async function loadDoctors() {
                const { data: doctors, error } = await supabase.from('doctors').select('*');
                if (error) {
                    console.error('Error cargando médicos:', error);
                    return;
                }

                const doctorContainer = document.getElementById('doctors');
                doctorContainer.innerHTML = doctors.map(doctor => `
                    <div class="doctor-card">
                        <div class="doctor-photo" style="background-image: url(${doctor.avatar_url || 'default-avatar.jpg'});"></div>
                        <h3>${doctor.name}</h3>
                        <div class="specialty">${doctor.specialty}</div>
                        <button class="btn btn-primary" onclick="openModal('appointment')">Agendar Cita</button>
                    </div>
                `).join('');
            }

            // Ejecutar la carga inicial de médicos
            loadDoctors();
        </script>
</html>
